<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Crumbl JS test</title>
</head>

<body>
    <main>
        <section>
            <p>Source: <span id="source">cdever@edgewhere.fr</span></p>
            <p>Crumbled: <span id="crumbled"></span></p>
            <p>Partial 1: <span id="uncrumb1"></span></p>
            <p>Partial 2: <span id="uncrumb2"></span></p>
            <p>Uuncrumbled: <span id="uncrumbled"></span></p>
        </section>
    </main>
    <script src="../../../dist/crumbljs.js"></script>
    <script type="text/javascript">
        // console.log(window);
        const source = document.getElementById('source').innerHTML;
        const owner = {
            encryptionAlgorithm: crumbljs.ECIES_ALGORITHM,
            publicKey: crumbljs.string2Buffer('04e315a987bd79b9f49d3a1c8bd1ef5a401a242820d52a3f22505da81dfcd992cc5c6e2ae9bc0754856ca68652516551d46121daa37afc609036ab5754fe7a82a3', 'hex'),
            privateKey: crumbljs.string2Buffer('b9fc3b425d6c1745b9c963c97e6e1d4c1db7a093a36e0cf7c0bf85dc1130b8a0', 'hex')
        };
        const trustee1 = {
            encryptionAlgorithm: crumbljs.ECIES_ALGORITHM,
            publicKey: crumbljs.string2Buffer('040c96f971c0edf58fe4afbf8735581be05554a8a725eae2b7ad2b1c6fcb7b39ef4e7252ed5b17940a9201c089bf75cb11f97e5c53333a424e4ebcca36065e0bc0', 'hex'),
            privateKey: crumbljs.string2Buffer('80219e4d24caf16cb4755c1ae85bad02b6a3efb1e3233379af6f2cc1a18442c4', 'hex')
        };
        const trustee2 = {
            encryptionAlgorithm: crumbljs.RSA_ALGORITHM,
            publicKey: crumbljs.string2Buffer(`-----BEGIN RSA PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvKrPmpvMq7Nyu96ZvH3H
4xWIyBqIe5g/ebN3XqevVZxeKrFdWHVNTF8kc8Ubm5pyb0e3i6jt1zOSWG1Q7Mzy
xmIsWy9ksMBBk2gL1uH1vdS4lwArjoqSCoX0kx8aVqNk76DD02YwW+bRL+UAQ3w/
7VS70piQGLohF6eukMuwvqrfzyoY/YgIY6a6D/2inM4Fk39eV2qzgTxA7eBDD6Gw
K/3R+6XsyKBTUEB2DF7iZvE7LBG0s4xWGDC1Bqh5Z8dRwCiKypZGB5PwXLhpqS8T
NE8lfOsvFLh/+4Ia/UfhKaWhwNHpK1tJTxGzWOcZD1r/yg+wdzJvMabhV2iZ9za3
lQIDAQAB
-----END RSA PUBLIC KEY-----`, 'utf-8'),
            privateKey: crumbljs.string2Buffer(`-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAvKrPmpvMq7Nyu96ZvH3H4xWIyBqIe5g/ebN3XqevVZxeKrFd
WHVNTF8kc8Ubm5pyb0e3i6jt1zOSWG1Q7MzyxmIsWy9ksMBBk2gL1uH1vdS4lwAr
joqSCoX0kx8aVqNk76DD02YwW+bRL+UAQ3w/7VS70piQGLohF6eukMuwvqrfzyoY
/YgIY6a6D/2inM4Fk39eV2qzgTxA7eBDD6GwK/3R+6XsyKBTUEB2DF7iZvE7LBG0
s4xWGDC1Bqh5Z8dRwCiKypZGB5PwXLhpqS8TNE8lfOsvFLh/+4Ia/UfhKaWhwNHp
K1tJTxGzWOcZD1r/yg+wdzJvMabhV2iZ9za3lQIDAQABAoIBAQCDdnpGfz10fwv5
gLibMQHxZ/XxiRuFE6dXRAhvemSgQN8U3JXwp3v/NWSPDs+X81y90blBpaplA9h7
qWB0QLMCLTI/L5z31F9dOWjWiIjVh74/6axwHHp6vrCXO1r898nDd8A8M76KqyEk
QGuYmqFo3Fwr+Iaf1EJu2za2SliT4gZsiRaLOcHvKx7pM1s1+2WmPGAOsCFEEBZF
Vc+vDpGUrcCCWrFzQQn1BFrYwJE35chXzUMbLIb3cf5mJ5qGE6YtHzL72qYywDjt
3iZhjCqa7mGngD8h3qHrOIFwghjYS5iETwAXY2ix+0iTorNCUBFDQYF8hz4ZsKGb
ju9K3OxBAoGBANAxrOVOfb1GOZsQ6YtPmtiuNh9P1msrk2UlW+vnzK4wIumIZEq7
tNbRosDo3EvNkkRrMqSRDblsjegdYEvYOAJHT2vKDbv0eS/9RGi/do3jiXPDiisH
kQv88qFAy3QpIeUeB/dUo5UOLLpq4ESELTJPsk5CxBrM9uYPQf3bv6L5AoGBAOf9
SSljt6T5ARgzQcQI8FUadrhEvSCnog0S4ngojFcY3SepeFkPyZBOPDXMszm01ZhU
YGXTDK0sqAxnMOA+5p2aYuFjGUXR/rZh8oRADITfQg1+ZN6AlNNocVWbJQWarMpC
QfFavWY2Fhl73Ex4l+zUgPGDrvOBrVnJD8FaqkR9AoGATmE1R0sKmZRzoYZ3dkQs
9sB3jcg/4C8SmbS7649kBnwG2MbJgz0xsuJPlLLWJQ+qrmlxMnWNpi5RKn7MvyES
zQDNzLXP/9/lNAT0mT7jwj1UhSmrvdFmcQ30xnKfZgcKRLjOpPXPdBFXE4OjFQhx
/4vzg/Us4S4jEa/S12DAv/kCgYAIh+3q0bntHSMHKsteVB3SY1i+SfjSfJee93TQ
il0uzsFDNh4w2D3HSrk4GUD1/EpmgaPR2sL6k0vSuPC5Llb4sLa2JxjE0oYVWuC6
MEjFkhgxutYmwH+4jnysczoXTKrR/UHDiFyyp4aEhWOChGTB1savGvKSDdC8HoKv
z4+3WQKBgAsYT/qx6Cjr+sTE6wz7He5sM4Jf6n4xfn4dq0YAUp/BjbjYRdohs9MW
ztOEXBTezNyc6rAD37JYzAMK3pjmCLzgkNH6I2HVjWQ7zqCmB4TNMSWLIDYl6ui5
oFsWqzoJBcTw0zYjRWhJge4H66XHwJB2q7g2YlqdG7JHXNGot4w/
-----END RSA PRIVATE KEY-----`, 'utf-8')
        };

        let crumbled = '';
        const workerCreator = new crumbljs.BrowserWorker({
            mode: crumbljs.CREATION,
            data: [source],
            htmlElement: document.getElementById('crumbled')
        });

        workerCreator.create([owner], [trustee1, trustee2])
            .then(crumbled => {
                console.log(crumbled);
                const workerExtractor1 = new crumbljs.BrowserWorker({
                    mode: crumbljs.EXTRACTION,
                    data: [
                        crumbled ? crumbled : '580fb8a91f05833200dea7d33536aaec9d7ceb256a9858ee68e330e126ba409d0000a8BJTkFAnzpe4fPWZWbZwaI68NbLq++xD6tKPnFcl3yWnmUKI3Evk1Ax3WZbqsU1uurEcGH9Kfjdmgm+/qjaUSilBCUwTfXE/SgDTVY0OYnFe/g3xN7gwOTUEUF470c00LDo/ns1dXULzZw6iunztApfptXbUVR590WX8Jsg==010158NwuvJKqSgOQjPveYXoCepULX3NtYAVXMCBioeq8bFi+MZWJVTmzYYIsZSpNJ3QvXV3QcaQHVXlQrtR05QatnGkiJqy9a0KZjQRzrYhatNqv+2PqIoFMHQ+Z+uiOYca0GuDEu293xMsdRv8Bh3FfQaCR5vt1iyCsyHwS0wEkfx0ubkZii27nXJH4ZADy8KGZIZqOhZ/PYSiDAqeUanMYCsMMpKKe34yhhsXNjuiNZxlkmoPMIgnR+9M4Qv2rqlW/2kiFAbEVv96GHH+TIT0tfUMlqpxc+3TJWMX+8xD8fdHU84INxFt5p0BEZypRJZEpkkzVEiPCoSU21apzT9CN8ew==0200a8BHiSlQ7Xj0QAH5+rpyfannbxj77iFokh+jdc1wj3QnxrLyjFAO6KfYaec0WujUdE7FOv2pV7Ch2WiJAwSz05VWbWY9zuHWVg24Ohl6XoLRS4E5nQMK1YKwZuCfl9otaVljrjcROtMv7kdaHFhQaq8vXd5m6XBiaJMnWXcQ==.1'
                    ],
                    htmlElement: document.getElementById('uncrumb1')
                });
                workerExtractor1.extract(trustee1, false)
                    .then(uncrumb1 => {
                        console.log(uncrumb1)
                        const workerExtractor2 = new crumbljs.BrowserWorker({
                            mode: crumbljs.EXTRACTION,
                            data: [
                                crumbled ? crumbled : '580fb8a91f05833200dea7d33536aaec9d7ceb256a9858ee68e330e126ba409d0000a8BJTkFAnzpe4fPWZWbZwaI68NbLq++xD6tKPnFcl3yWnmUKI3Evk1Ax3WZbqsU1uurEcGH9Kfjdmgm+/qjaUSilBCUwTfXE/SgDTVY0OYnFe/g3xN7gwOTUEUF470c00LDo/ns1dXULzZw6iunztApfptXbUVR590WX8Jsg==010158NwuvJKqSgOQjPveYXoCepULX3NtYAVXMCBioeq8bFi+MZWJVTmzYYIsZSpNJ3QvXV3QcaQHVXlQrtR05QatnGkiJqy9a0KZjQRzrYhatNqv+2PqIoFMHQ+Z+uiOYca0GuDEu293xMsdRv8Bh3FfQaCR5vt1iyCsyHwS0wEkfx0ubkZii27nXJH4ZADy8KGZIZqOhZ/PYSiDAqeUanMYCsMMpKKe34yhhsXNjuiNZxlkmoPMIgnR+9M4Qv2rqlW/2kiFAbEVv96GHH+TIT0tfUMlqpxc+3TJWMX+8xD8fdHU84INxFt5p0BEZypRJZEpkkzVEiPCoSU21apzT9CN8ew==0200a8BHiSlQ7Xj0QAH5+rpyfannbxj77iFokh+jdc1wj3QnxrLyjFAO6KfYaec0WujUdE7FOv2pV7Ch2WiJAwSz05VWbWY9zuHWVg24Ohl6XoLRS4E5nQMK1YKwZuCfl9otaVljrjcROtMv7kdaHFhQaq8vXd5m6XBiaJMnWXcQ==.1'
                            ],
                            verificationHash: '580fb8a91f05833200dea7d33536aaec9d7ceb256a9858ee68e330e126ba409d', // clearly optional for trusted third-party
                            htmlElement: document.getElementById('uncrumb2')
                        });
                        workerExtractor2.extract(trustee2, false)
                            .then(uncrumb2 => {
                                console.log(uncrumb2)
                                const workerOwner = new crumbljs.BrowserWorker({
                                    mode: crumbljs.EXTRACTION,
                                    data: [
                                        crumbled ? crumbled : '580fb8a91f05833200dea7d33536aaec9d7ceb256a9858ee68e330e126ba409d0000a8BJTkFAnzpe4fPWZWbZwaI68NbLq++xD6tKPnFcl3yWnmUKI3Evk1Ax3WZbqsU1uurEcGH9Kfjdmgm+/qjaUSilBCUwTfXE/SgDTVY0OYnFe/g3xN7gwOTUEUF470c00LDo/ns1dXULzZw6iunztApfptXbUVR590WX8Jsg==010158NwuvJKqSgOQjPveYXoCepULX3NtYAVXMCBioeq8bFi+MZWJVTmzYYIsZSpNJ3QvXV3QcaQHVXlQrtR05QatnGkiJqy9a0KZjQRzrYhatNqv+2PqIoFMHQ+Z+uiOYca0GuDEu293xMsdRv8Bh3FfQaCR5vt1iyCsyHwS0wEkfx0ubkZii27nXJH4ZADy8KGZIZqOhZ/PYSiDAqeUanMYCsMMpKKe34yhhsXNjuiNZxlkmoPMIgnR+9M4Qv2rqlW/2kiFAbEVv96GHH+TIT0tfUMlqpxc+3TJWMX+8xD8fdHU84INxFt5p0BEZypRJZEpkkzVEiPCoSU21apzT9CN8ew==0200a8BHiSlQ7Xj0QAH5+rpyfannbxj77iFokh+jdc1wj3QnxrLyjFAO6KfYaec0WujUdE7FOv2pV7Ch2WiJAwSz05VWbWY9zuHWVg24Ohl6XoLRS4E5nQMK1YKwZuCfl9otaVljrjcROtMv7kdaHFhQaq8vXd5m6XBiaJMnWXcQ==.1',
                                        uncrumb1 ? uncrumb1 : '580fb8a91f05833200dea7d33536aaec9d7ceb256a9858ee68e330e126ba409d%02AgICAgJcRwkYUkI=.1',
                                        uncrumb2 ? uncrumb2 : '580fb8a91f05833200dea7d33536aaec9d7ceb256a9858ee68e330e126ba409d%01AgICAnYEVQMOTg8=.1'
                                    ],
                                    verificationHash: '580fb8a91f05833200dea7d33536aaec9d7ceb256a9858ee68e330e126ba409d',
                                    htmlElement: document.getElementById('uncrumbled')
                                });
                                workerOwner.extract(owner, true)
                                    .then(uncrumbled => {
                                        console.log(uncrumbled)
                                    })
                            });
                    });
            });
    </script>
</body>

</html>